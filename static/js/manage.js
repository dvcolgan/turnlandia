// Generated by CoffeeScript 1.6.3
var async, db, manage, request;

request = require('request');

async = require('async');

db = 'http://127.0.0.1:5984';

manage = {
  clearSquares: function() {
    return async.series([
      function(callback) {
        console.log('deleting old actions database');
        return request({
          url: db + '/turnbased_dev_actions',
          method: 'DELETE'
        }, function() {
          return callback();
        });
      }, function(callback) {
        console.log('deleting old squares database');
        return request({
          url: db + '/turnbased_dev_squares',
          method: 'DELETE'
        }, function() {
          return callback();
        });
      }, function(callback) {
        console.log('creating new actions database');
        return request({
          url: db + '/turnbased_dev_actions',
          method: 'PUT'
        }, function() {
          return callback();
        });
      }, function(callback) {
        console.log('creating new squares database');
        return request({
          url: db + '/turnbased_dev_squares',
          method: 'PUT'
        }, function() {
          return callback();
        });
      }, function(callback) {
        var designDoc;
        console.log('adding actions design document');
        designDoc = {
          _id: '_design/actions',
          'language': 'coffeescript',
          'views': {
            'get': {
              'map': '(doc) -> emit(doc.userID, doc)'
            }
          }
        };
        return request({
          url: db + '/turnbased_dev_actions/_design/actions',
          method: 'PUT',
          json: true,
          body: designDoc
        }, function() {
          return callback();
        });
      }, function(callback) {
        var designDoc;
        console.log('adding squares design document');
        designDoc = {
          _id: '_design/squares',
          'language': 'coffeescript',
          'views': {
            'get': {
              'map': '(doc) -> emit([doc.col, doc.row], doc)'
            }
          }
        };
        return request({
          url: db + '/turnbased_dev_squares/_design/squares',
          method: 'PUT',
          json: true,
          body: designDoc
        }, function() {
          return console.log('done');
        });
      }
    ]);
  }
};

manage[process.argv[2]]();
