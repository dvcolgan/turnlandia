// Generated by CoffeeScript 1.6.3
var System;

System = (function() {
  function System() {
    var _this = this;
    window.TB = this;
    this.moves = [];
    this.current_action = 'place';
    $.getJSON('/api/initial-load/', function(data, status) {
      var move, _i, _len, _ref;
      if (status === 'success') {
        _.extend(_this, data.board_consts);
        _ref = data.moves;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          move = _ref[_i];
          _this.add_move(move);
        }
        _this.account = data.account;
      }
      return _this.board = new Board($('#board'));
    });
    $(document).keydown(function(event) {
      switch (event.which) {
        case 49:
          return _this.set_action('move');
        case 50:
          return _this.set_action('attack');
        case 51:
          return _this.set_action('city');
      }
    });
    $('.btn-action').click(function(event) {
      return _this.set_action($(event.target).data('action'));
    });
  }

  System.prototype.set_action = function(action) {
    var $btn_dom_node;
    console.log('setting action to ' + action);
    this.current_action = action;
    $btn_dom_node = $('button[data-action=' + action + ']');
    $('.btn-action').not($btn_dom_node).removeClass('active');
    return $btn_dom_node.addClass('active');
  };

  System.prototype.add_move = function(data) {
    return this.moves.push(new Move(data));
  };

  return System;

})();

new System();
